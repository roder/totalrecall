version: '3.8'

services:
  totalrecall:
    build:
      context: .
      dockerfile: Containerfile
    container_name: totalrecall
    restart: unless-stopped
    volumes:
      # Mount entire base directory (config files at top level, data and logs in subdirs)
      # Config files (config.toml, credentials.toml) go at top level
      # Data directory: writable for cache and application data
      # Logs directory: writable for application logs
      - ./totalrecall:/app
    environment:
      - RUST_LOG=info
      - RUST_LOG_JSON=true
    command: ["start"]
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    healthcheck:
      # Check if the daemon process is running
      test: ["CMD", "pgrep", "-f", "totalrecall start"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

